<div class="padding-md">
    <div class="smart-widget">
    <div class="smart-widget-inner">
        <div class="smart-widget-body">
            <form class="form-horizontal no-margin" method="post" id="form">
                <div class="form-group">
                    <label class="control-label col-md-3">登录帐号</label>
                    <div class="col-md-5">
                        <input type="text" class="form-control input-sm" value="{$username}" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-3">旧密码</label>
                    <div class="col-md-5">
                        <input type="password" class="form-control input-sm" name="info[old_password]" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-3">新密码</label>
                    <div class="col-md-5">
                        <input type="password" class="form-control input-sm" name="info[new_password]" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-3">再次输入密码</label>
                    <div class="col-md-5">
                        <input type="password" class="form-control input-sm" name="info[re_password]" required>
                    </div>
                </div>
                <div class="text-center m-top-md">
                    <button type="submit" class="btn btn-info">提交</button>
                </div>
            </form>
        </div>
    </div>
    </div>
</div>

<script src="{:C('ADMIN_JS_PATH')}/jquery.validate.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $("#form").validate({
        rules: {
            "info[old_password]": {
                required: true,
                minlength: 5
            },
            "info[new_password]": {
                required: true,
                minlength: 5
            },
            "info[re_password]": {
                required: true,
                minlength: 5
            }
        },
        messages: {
            "info[old_password]": {
                required: "请输入旧密码",
                minlength: "密码至少由五个字符组成"
            },
            "info[new_password]": {
                required: "请输入新密码",
                minlength: "密码至少由五个字符组成"
            },
            "info[re_password]": {
                required: "请再次输入密码",
                minlength: "密码至少由五个字符组成"
            }
        },
        submitHandler: function (form) {
            confirm();
        }
    });
    function confirm() {
        DMS.ajaxPost("__CONTROLLER__/changePassword", $('#form').serialize(), function (ret) {
            if (ret.status == 1) {
                DMS.success("提交成功", 0, function () {
                    if (ret.url) {
                        window.location.href = ret.url;
                    } else {
                        window.location.href = window.location.href;
                    }
                });
            } else {
                DMS.error('' + ret.info + '', 0);
            }
        })
    }

</script>